<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>ุงูููุตุฉ ุงูุฅุณูุงููุฉ โ ููู ูุงุญุฏ (ุชุดุบูู ูุงูู ููุณูุฑ)</title>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;800;900&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/hls.js@1"></script>
<style>
  :root{
    --bg:#0b1220;
    --card:#121a2b;
    --text:#f5f7fb;
    --muted:#9fb0d0;
    --brand:#0ea37a; /* default green */
    --brand-weak:rgba(14,163,122,.12);
  }
  html.light{ --bg:#f7fafc; --card:#ffffff; --text:#0e1726; --muted:#667892; }
  html.theme-cyan{ --brand:#0ea5e9; --brand-weak:rgba(14,165,233,.12); }
  html.theme-purple{ --brand:#8b5cf6; --brand-weak:rgba(139,92,246,.12); }

  *{ box-sizing:border-box }
  body{ margin:0; font-family:"Cairo",system-ui,-apple-system,Segoe UI,Roboto; background:var(--bg); color:var(--text); }
  a{ color:var(--brand); text-decoration:none }
  .container{ max-width:1100px; margin:0 auto; padding:16px }

  /* Navbar */
  .nav{ position:sticky; top:0; z-index:20; backdrop-filter:saturate(1.2) blur(8px);
        background:linear-gradient(180deg, rgba(0,0,0,.45), rgba(0,0,0,0)) }
  html.light .nav{ background:linear-gradient(180deg, rgba(255,255,255,.75), rgba(255,255,255,0)) }
  .nav-inner{ display:flex; gap:10px; align-items:center; justify-content:space-between; padding:10px 16px }
  .brand{ font-weight:800; letter-spacing:.5px }
  .tabs{ display:flex; gap:6px; flex-wrap:wrap }
  .tab{ border:1px solid transparent; background:var(--brand-weak); color:var(--brand); padding:8px 12px; border-radius:999px; cursor:pointer; font-weight:600; }
  .tab.active{ background:var(--brand); color:#fff }
  .controls{ display:flex; gap:6px; align-items:center }
  .btn{ background:var(--brand); color:#fff; border:none; padding:10px 14px; border-radius:12px; cursor:pointer; font-weight:700 }
  .btn.sm{ padding:6px 10px; border-radius:10px; font-weight:600 }
  .ghost{ background:transparent; border:1px solid var(--brand); color:var(--brand) }
  .select{ background:transparent; border:1px solid var(--muted); color:var(--text); padding:8px 10px; border-radius:10px }
  html.light .select{ background:#fff }
  .field{ background:transparent; border:1px solid var(--muted); border-radius:10px; padding:8px 10px; color:var(--text) }
  html.light .field{ background:#fff }

  /* Sections */
  section{ display:none; animation: fade .35s ease }
  section.active{ display:block }
  @keyframes fade { from{opacity:0; transform:translateY(4px)} to{opacity:1; transform:none} }

  /* Parallax hero */
  .hero{ position:relative; border-radius:18px; overflow:hidden; min-height:240px; display:grid; place-items:center; text-align:center; padding:32px }
  .hero-bg{ position:absolute; inset:-20%; background:radial-gradient(60% 80% at 60% 30%, var(--brand-weak), transparent),
                                   radial-gradient(60% 80% at 10% 90%, rgba(255,255,255,.05), transparent); transform:translateZ(0) }
  .hero h1{ position:relative; z-index:1; margin:0; font-size:28px }
  .muted{ color:var(--muted) }

  /* Cards / grid */
  .grid{ display:grid; gap:12px }
  .cols-2{ grid-template-columns: repeat(2, 1fr) }
  .cols-3{ grid-template-columns: repeat(3, 1fr) }
  @media (max-width:900px){ .cols-3{ grid-template-columns:1fr 1fr } }
  @media (max-width:640px){ .cols-3,.cols-2{ grid-template-columns:1fr } }
  .card{ background:var(--card); border:1px solid rgba(255,255,255,.06); padding:14px; border-radius:16px }
  html.light .card{ border:1px solid rgba(0,0,0,.06) }
  .badge{ background:var(--brand-weak); color:var(--brand); padding:6px 10px; border-radius:999px; font-weight:700; display:inline-block }
  .heading{ display:flex; align-items:center; justify-content:space-between; gap:8px; margin-bottom:8px }
  .kicker{ font-weight:800; color:var(--brand) }
  .pill{ padding:6px 10px; background:rgba(255,255,255,.06); border-radius:999px }
  .row{ display:flex; align-items:center; gap:8px; flex-wrap:wrap }

  .mini-player{ position:fixed; right:16px; bottom:16px; background:var(--card); border:1px solid rgba(255,255,255,.08); padding:10px 12px; border-radius:14px; z-index:90; display:flex; align-items:center; gap:8px }
  .mini-player .title{ font-weight:700; max-width:44vw; white-space:nowrap; overflow:hidden; text-overflow:ellipsis }
  .prog{ height:6px; border-radius:999px; background:#ffffff22; overflow:hidden }
  .prog > span{ display:block; height:100%; background:var(--brand); width:0% }

  /* Ayah highlight */
  .ayah{ display:inline-block; margin:4px; line-height:2; }
  .ayah .num{ color:var(--muted); font-size:.85em }
  .ayah.current{ background:rgba(14,163,122,.12); box-shadow:0 0 0 2px var(--brand-weak) inset; border-radius:10px; padding:0 6px }
</style>
</head>
<body>
  <div class="nav">
    <div class="nav-inner container">
      <div class="brand">๐ ุงูููุตุฉ ุงูุฅุณูุงููุฉ</div>
      <div class="tabs" id="mainTabs">
        <button class="tab active" data-to="home">ุงูุฑุฆูุณูุฉ</button>
        <button class="tab" data-to="prayer">ููุงููุช ุงูุตูุงุฉ</button>
        <button class="tab" data-to="live">ุงูุจุซ ุงููุจุงุดุฑ</button>
        <button class="tab" data-to="quran">ุงููุตุญู</button>
        <button class="tab" data-to="azkar">ุงูุฃุฐูุงุฑ</button>
        <button class="tab" data-to="fav">ุงูููุถูุฉ</button>
        <button class="tab" data-to="search">ุงูุจุญุซ</button>
      </div>
      <div class="controls">
        <select class="select" id="theme">
          <option value="dark-green">๐ ุฃุฎุถุฑ</option>
          <option value="dark-cyan">๐ ุณูุงูู</option>
          <option value="dark-purple">๐ ุจููุณุฌู</option>
          <option value="light-green">โ๏ธ ุฃุฎุถุฑ</option>
          <option value="light-cyan">โ๏ธ ุณูุงูู</option>
          <option value="light-purple">โ๏ธ ุจููุณุฌู</option>
        </select>
      </div>
    </div>
  </div>

  <main class="container">
    <!-- Home -->
    <section id="home" class="active">
      <div class="hero" id="homeHero">
        <div class="hero-bg" id="parallax"></div>
        <div>
          <div class="badge kicker">ุจูุงุจุฉ ุณุฑูุนุฉ</div>
          <h1>ูุฑุญุจูุง ุจู โ ุงุฎุชุฑ ูุณูู: ููุงููุช ุงูุตูุงุฉุ ุงูุจุซุ ุงููุตุญูุ ุงูุฃุฐูุงุฑ</h1>
          <p class="muted" id="homeClock"></p>
        </div>
      </div>

      <div class="grid cols-3" style="margin-top:14px">
        <div class="card">
          <div class="heading"><strong>ุขูุฉ ุงูููู</strong><span class="badge">Quran</span></div>
          <p id="ayahOfDay" style="line-height:2"></p>
          <div class="row"><button class="btn sm" id="ayahPlay">ุชุดุบูู</button><button class="btn sm ghost" id="ayahFav">โญ ุญูุธ</button></div>
        </div>
        <div class="card">
          <div class="heading"><strong>ุฐูุฑ ุงูููู</strong><span class="badge">Azkar</span></div>
          <p id="dhikrOfDay" style="white-space:pre-wrap; line-height:2"></p>
          <div class="row"><button class="btn sm" id="dhikrChime">๐ ูุคุซุฑ</button><button class="btn sm ghost" id="dhikrFav">โญ ุญูุธ</button></div>
        </div>
        <div class="card">
          <div class="heading"><strong>ุฅุญุตุงุฆูุงุชู ุงูููู</strong><span class="badge">Stats</span></div>
          <p class="muted">ุงูุฃุฐูุงุฑ ุงูููุฑูุกุฉ: <b id="statAzkar">0</b> โ ุงูุณูุฑ ุงูููุณุชูุน ููุง: <b id="statSurah">0</b></p>
          <div class="row">
            <button class="btn sm ghost" id="resetStats">ุฅุนุงุฏุฉ ุถุจุท</button>
          </div>
        </div>
      </div>
    </section>

    <!-- Prayer -->
    <section id="prayer">
      <div class="heading"><strong>๐ ููุงููุช ุงูุตูุงุฉ</strong><span class="badge" id="locBadge">ุฌุงุฑู ุชุญุฏูุฏ ุงููููุนโฆ</span></div>
      <div class="grid cols-3" id="prayerGrid"></div>
      <div class="card" style="margin-top:12px">
        <div class="heading"><strong>โณ ุงูุนุฏูุงุฏ</strong><span class="badge" id="nextPrayerBadge">โ</span></div>
        <p class="muted" id="countdown">--:--:--</p>
      </div>
    </section>

    <!-- Live -->
    <section id="live">
      <div class="heading"><strong>๐ป ุงูุจุซ ุงููุจุงุดุฑ</strong><span class="badge">HLS + ุงุญุชูุงุทูุงุช</span></div>
      <div class="grid cols-3" id="radioGrid"></div>
      <div class="card">
        <div class="row">
          <input class="field" id="customStream" placeholder="ุฃุฏุฎู ุฑุงุจุท ุจุซ ูุฎุตุต (MP3/HLS)" style="min-width:260px">
          <button class="btn sm" id="addStream">โ ุฅุถุงูุฉ</button>
        </div>
      </div>
      <div class="mini-player" id="mini" style="display:none">
        <span class="title" id="miniTitle">โ</span>
        <div class="prog" style="width:140px"><span id="miniProg"></span></div>
        <button class="btn sm" id="miniToggle">โฏ</button>
        <button class="btn sm ghost" id="miniStop">โน</button>
      </div>
      <audio id="liveAudio" preload="none" crossorigin="anonymous"></audio>
      <video id="liveVideo" playsinline style="width:1px;height:1px;opacity:0;position:absolute;pointer-events:none"></video>
    </section>

    <!-- Quran -->
    <section id="quran">
      <div class="heading"><strong>๐ ุงููุตุญู</strong><span class="badge">ุชุดุบูู ูุงูู ููุณูุฑ + ุชุธููู ุงูุขูุฉ</span></div>
      <div class="card">
        <div class="row">
          <select class="select" id="surahSelect"></select>
          <select class="select" id="reciterSelect"></select>
          <button class="btn sm" id="playSurah">โถ ุชุดุบูู ุงูุณูุฑุฉ</button>
          <button class="btn sm ghost" id="pauseSurah">โฏ ุฅููุงู ูุคูุช</button>
          <button class="btn sm ghost" id="stopSurah">โน ุฅููุงู</button>
          <button class="btn sm ghost" id="prevAyah">โฉ ุงูุขูุฉ ุงูุณุงุจูุฉ</button>
          <button class="btn sm ghost" id="nextAyah">โช ุงูุขูุฉ ุงูุชุงููุฉ</button>
          <label class="pill"><input id="repeatAyah" type="checkbox"> ุชูุฑุงุฑ ุงูุขูุฉ</label>
        </div>
        <div class="row" style="margin-top:6px">
          <span class="badge" id="ayahCounter">โ</span>
          <div class="prog" style="flex:1;max-width:360px"><span id="qProg"></span></div>
        </div>
        <div id="quranText" style="margin-top:12px; line-height:2"></div>
      </div>
    </section>

    <!-- Azkar -->
    <section id="azkar">
      <div class="heading"><strong>๐คฒ ุงูุฃุฐูุงุฑ</strong><span class="badge">ูุตูุต ูุงููุฉ + ุนุฏุงุฏ</span></div>
      <div class="tabs" id="azTabs" style="margin-bottom:8px">
        <button class="tab active" data-key="sabah">ุฃุฐูุงุฑ ุงูุตุจุงุญ</button>
        <button class="tab" data-key="masa">ุฃุฐูุงุฑ ุงููุณุงุก</button>
        <button class="tab" data-key="prayer">ุฃุฐูุงุฑ ุจุนุฏ ุงูุตูุงุฉ</button>
        <button class="tab" data-key="ruqyah">ุงูุฑููููุฉ ุงูุดุฑุนูุฉ</button>
        <button class="tab" data-key="sleep">ุฃุฐูุงุฑ ุงูููู</button>
        <button class="tab" data-key="wudu">ุฃุฐูุงุฑ ุงููุถูุก</button>
      </div>
      <div class="row" style="margin-bottom:8px">
        <input class="field" id="azSearch" placeholder="ุงุจุญุซ ุฏุงุฎู ุงูุฃุฐูุงุฑ">
        <button class="btn sm ghost" id="autoRead">ุชุดุบูู ูุชุชุงุจุน</button>
        <button class="btn sm" id="copyAll">ูุณุฎ ุงููู</button>
      </div>
      <div id="azContainer" class="grid cols-1"></div>
    </section>

    <!-- Favorites -->
    <section id="fav">
      <div class="heading"><strong>โญ ุงูููุถูุฉ</strong><span class="badge">ูุญููุธ ูุญูููุง</span></div>
      <div id="favList" class="grid cols-1"></div>
    </section>

    <!-- Search -->
    <section id="search">
      <div class="heading"><strong>๐ ุงูุจุญุซ</strong><span class="badge">ุขูุงุช + ุฃุฐูุงุฑ</span></div>
      <div class="row">
        <input class="field" id="siteQuery" placeholder="ุงูุชุจ ูููุฉ (ุขูุฉ / ุฐูุฑ / ุณูุฑุฉ)">
        <button class="btn sm" id="siteGo">ุจุญุซ</button>
      </div>
      <div id="siteResults" class="grid cols-1" style="margin-top:12px"></div>
    </section>
  </main>

<script>
/* ======== GLOBAL ERROR TOAST ======== */
window.addEventListener('error', (e)=>{
  console.warn('Script error:', e.message);
  const t = document.createElement('div');
  t.style.cssText='position:fixed;left:16px;bottom:16px;background:#c0392b;color:#fff;padding:10px 12px;border-radius:10px;z-index:9999';
  t.textContent='ุญุฏุซ ุฎุทุฃ ุจุงูุณูุฑุจุช: ' + e.message;
  document.body.appendChild(t);
  setTimeout(()=>t.remove(), 6000);
});

/* ======== THEME ======== */
(function(){
  const html = document.documentElement;
  const select = document.getElementById('theme');
  const saved = localStorage.getItem('theme') || 'dark-green';
  apply(saved);
  select.value = saved;
  select.onchange = ()=>{ apply(select.value); };

  function apply(val){
    localStorage.setItem('theme', val);
    html.classList.remove('light', 'theme-cyan', 'theme-purple');
    const [mode, hue] = val.split('-'); // dark/light - green/cyan/purple
    if(mode === 'light') html.classList.add('light');
    if(hue === 'cyan') html.classList.add('theme-cyan');
    if(hue === 'purple') html.classList.add('theme-purple');
    const hour = new Date().getHours();
    document.getElementById('homeHero').style.background = hour>=19||hour<5 ? 'linear-gradient(120deg,#0b1020,#121a2b)' : 'linear-gradient(120deg,#0a6144,#0b1220)';
  }
})();

/* ======== ROUTER ======== */
document.getElementById('mainTabs').addEventListener('click', (e)=>{
  const to = e.target.getAttribute('data-to'); if(!to) return;
  document.querySelectorAll('main section').forEach(s=>s.classList.remove('active'));
  document.getElementById(to).classList.add('active');
  document.querySelectorAll('.nav .tab').forEach(t=>t.classList.remove('active'));
  e.target.classList.add('active');
  window.scrollTo({top:0, behavior:'smooth'});
});

/* ======== PARALLAX ======== */
document.addEventListener('mousemove', (e)=>{
  const p = document.getElementById('parallax');
  const x = (e.clientX / innerWidth - .5)*8;
  const y = (e.clientY / innerHeight - .5)*8;
  p.style.transform = `translate(${x}px, ${y}px)`;
});

/* ======== HOME ======== */
(function(){
  const ayahEl = document.getElementById('ayahOfDay');
  const dhikrEl = document.getElementById('dhikrOfDay');
  const clock = document.getElementById('homeClock');
  clock.textContent = new Date().toLocaleString('ar-EG',{dateStyle:'full', timeStyle:'medium'});

  ayahEl.textContent = 'ูููู ูููู ูฑูููููู ุฃูุญูุฏู ูฑูููููู ูฑูุตููููุฏู...';
  let ayahAudio = null;
  fetch('https://api.alquran.cloud/v1/ayah/1:1/ar.alafasy').then(r=>r.json()).then(j=>{
    if(j && j.data){ ayahEl.textContent = j.data.text; ayahAudio = j.data.audio; }
  }).catch(()=>{});

  const list = [{text:'ุงููููููููู ุตูููู ููุณูููููู ุนูู ูุจููุง ูุญูุฏ',count:10},{text:'ุณุจุญุงู ุงููู ูุจุญูุฏู',count:100}];
  const m = list[Math.floor(Math.random()*list.length)];
  dhikrEl.textContent = m.text;

  document.getElementById('ayahPlay').onclick = ()=>{
    if(!ayahAudio){ beep(); return; }
    const a = new Audio(ayahAudio); a.play();
    setMini(a, 'ุขูุฉ ุงูููู');
  };
  document.getElementById('ayahFav').onclick = ()=> addFav('ayah', ayahEl.textContent);
  document.getElementById('dhikrFav').onclick = ()=> addFav('dhikr', dhikrEl.textContent);
  document.getElementById('dhikrChime').onclick = ()=> beep();

  function beep(){
    const ctx = new (window.AudioContext||window.webkitAudioContext)();
    const o = ctx.createOscillator(); const g = ctx.createGain();
    o.type='sine'; o.frequency.value=880; o.connect(g); g.connect(ctx.destination);
    o.start(); g.gain.setValueAtTime(0.0001, ctx.currentTime);
    g.gain.exponentialRampToValueAtTime(0.25, ctx.currentTime+0.01);
    g.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime+0.25);
    o.stop(ctx.currentTime+0.26);
  }
})();

/* ======== PRAYER TIMES ======== */
(function(){
  const grid = document.getElementById('prayerGrid');
  const badge = document.getElementById('locBadge');
  const cd = document.getElementById('countdown');
  const nextBadge = document.getElementById('nextPrayerBadge');

  function renderTimes(tims){
    grid.innerHTML = '';
    const names = [
      ['Fajr','ุงููุฌุฑ','๐','#daf2ff'],
      ['Dhuhr','ุงูุธูุฑ','โ๏ธ','#fff0d6'],
      ['Asr','ุงูุนุตุฑ','๐ค๏ธ','#dfe7ff'],
      ['Maghrib','ุงููุบุฑุจ','๐','#ffd7b0'],
      ['Isha','ุงูุนุดุงุก','๐','#ccd6ff']
    ];
    let next = null, nextDiff = Infinity;
    names.forEach(([k,ar,emoji,bg])=>{
      const val = tims[k];
      const box = document.createElement('div'); box.className='card';
      box.innerHTML = `<div class="heading"><strong>${emoji} ${ar}</strong><span class="badge">${val}</span></div>`;
      box.style.backgroundImage = `linear-gradient(0deg, ${bg}11, transparent)`;
      grid.appendChild(box);
      const dt = toToday(val);
      const diff = dt - Date.now();
      if(diff>0 && diff<nextDiff){ next= [ar, dt]; nextDiff = diff; }
    });
    if(next){ nextBadge.textContent = `ุงูุตูุงุฉ ุงููุงุฏูุฉ: ${next[0]}`; tick(next[1]); }
  }

  function toToday(hhmm){
    const [h,m] = hhmm.split(':').map(Number);
    const d = new Date();
    d.setHours(h, m, 0, 0);
    if(d.getTime() <= Date.now()) d.setDate(d.getDate()+1);
    return d.getTime();
  }
  function tick(t){
    function step(){
      const diff = t - Date.now();
      if(diff<=0){ cd.textContent = 'ุญุงู ุงูุขู ููุช ุงูุตูุงุฉ'; return; }
      const h = Math.floor(diff/3600000);
      const m = Math.floor((diff%3600000)/60000);
      const s = Math.floor((diff%60000)/1000);
      cd.textContent = `${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
      requestAnimationFrame(step);
    } step();
  }

  function getTimes(lat, lon){
    badge.textContent = 'ุชู โ ุชุญุฏูุฏ ุงููููุน';
    const url = `https://api.aladhan.com/v1/timings?latitude=${lat}&longitude=${lon}&method=5`;
    fetch(url).then(r=>r.json()).then(j=>{
      if(j && j.data){ renderTimes(j.data.timings); }
      else{ badge.textContent='ุชุนุฐูุฑ ุงูุฌูุจ โ ุงูุชุฑุงุถู ุงููุงูุฑุฉ'; renderDefault(); }
    }).catch(()=>{ badge.textContent='ุชุนุฐูุฑ ุงูุฌูุจ โ ุงูุชุฑุงุถู ุงููุงูุฑุฉ'; renderDefault(); });
  }
  function renderDefault(){
    renderTimes({Fajr:'05:00',Dhuhr:'12:00',Asr:'15:30',Maghrib:'18:10',Isha:'19:30'});
  }

  if(navigator.geolocation){
    navigator.geolocation.getCurrentPosition((pos)=>{
      getTimes(pos.coords.latitude, pos.coords.longitude);
    }, ()=>{ badge.textContent='ุงูุชุฑุงุถู: ุงููุงูุฑุฉ'; getTimes(30.0444, 31.2357); });
  }else{
    badge.textContent='ุงูุชุฑุงุถู: ุงููุงูุฑุฉ'; getTimes(30.0444, 31.2357);
  }
})();

/* ======== LIVE RADIO (HLS + fallbacks) ======== */
(function(){
  const grid = document.getElementById('radioGrid');
  const a = document.getElementById('liveAudio');
  const v = document.getElementById('liveVideo');
  const mini = document.getElementById('mini');
  const miniTitle = document.getElementById('miniTitle');
  const miniProg = document.getElementById('miniProg');
  let hls = null;

  const streams = [
    { title:'ุฅุฐุงุนุฉ ุงููุฑุขู ุงููุฑูู ุงููุตุฑูุฉ', sources:[
      'https://stream.radiojar.com/8s5u5tpdtwzuv',
      'https://philae.shoutca.st:8222/Quran'
    ]},
    { title:'ุฅุฐุงุนุฉ ุงูุญุฑู ุงูููู', sources:[
      'https://cdnamd-hls-globecast.akamaized.net/live/ramdisk/saudi_quran/hls1/saudi_quran.m3u8',
      'https://svs.itworkscdn.net/quranlive/quran.smil/playlist.m3u8'
    ]},
    { title:'ุฅุฐุงุนุฉ ุงููุณุฌุฏ ุงููุจูู', sources:[
      'https://cdnamd-hls-globecast.akamaized.net/live/ramdisk/saudi_sunnah/hls1/saudi_sunnah.m3u8',
      'https://svs.itworkscdn.net/sunnahlive/sunnah.smil/playlist.m3u8'
    ]},
  ];
  const custom = JSON.parse(localStorage.getItem('streams')||'[]');
  custom.forEach(s=>streams.push(s));

  streams.forEach((s,idx)=>{
    const el = document.createElement('div'); el.className='card';
    el.innerHTML = `<div class="heading"><strong>${s.title}</strong><span class="badge">ุจุซ ูุจุงุดุฑ</span></div>
    <div class="row">
      <button class="btn sm" data-play="${idx}">โถ ุชุดุบูู</button>
      <button class="btn sm ghost" data-stop="${idx}">โน ุฅููุงู</button>
    </div>`;
    grid.appendChild(el);
  });

  grid.addEventListener('click', (e)=>{
    const p = e.target.getAttribute('data-play');
    const s = e.target.getAttribute('data-stop');
    if(p!=null) start(parseInt(p,10));
    if(s!=null) stop();
  });

  function start(i){
    stop();
    const list = streams[i].sources.slice();
    miniTitle.textContent = streams[i].title;
    trySource(list);
  }
  function stop(){
    try{ a.pause(); a.removeAttribute('src'); }catch{}
    try{ v.pause(); v.removeAttribute('src'); }catch{}
    if(hls){ try{ hls.destroy(); }catch{} hls=null; }
    mini.style.display='none';
  }
  function trySource(list){
    if(!list.length){ alert('ุชุนุฐุฑ ุงูุชุดุบูู โ โ ุฌุฑูุจ ุฑุงุจุทูุง ุขุฎุฑ'); return; }
    const url = list.shift();
    if(url.endsWith('.m3u8')){
      if(v.canPlayType('application/vnd.apple.mpegURL')){
        v.src = url; v.play().then(()=> showMini(v)).catch(()=> trySource(list));
      }else if(window.Hls && Hls.isSupported()){
        hls = new Hls({maxBufferLength:30});
        hls.loadSource(url); hls.attachMedia(v);
        hls.on(Hls.Events.MANIFEST_PARSED, ()=> v.play().then(()=> showMini(v)).catch(()=> trySource(list)));
        hls.on(Hls.Events.ERROR, (_,data)=>{ if(data.fatal) trySource(list); });
      }else{
        trySource(list);
      }
    }else{
      a.src = url; a.play().then(()=> showMini(a)).catch(()=> trySource(list));
    }
  }
  function showMini(media){
    mini.style.display='flex';
    setMini(media, miniTitle.textContent, miniProg);
  }

  document.getElementById('addStream').onclick = ()=>{
    const url = (document.getElementById('customStream').value||'').trim();
    if(!url) return;
    const item = { title:'ุจุซ ูุฎุตุต', sources:[url] };
    const list = JSON.parse(localStorage.getItem('streams')||'[]');
    list.push(item); localStorage.setItem('streams', JSON.stringify(list));
    location.reload();
  };
})();

/* ======== MINI PLAYER (shared) ======== */
function setMini(media, title, progEl){
  const box = document.getElementById('mini') || document.querySelector('.mini-player');
  if(!box) return;
  box.style.display='flex';
  const ttl = document.getElementById('miniTitle') || box.querySelector('.title');
  const toggle = document.getElementById('miniToggle');
  const stop = document.getElementById('miniStop');
  const bar = progEl || document.getElementById('miniProg');
  ttl.textContent = title||'ุชุดุบูู';

  const upd = ()=>{
    if(!bar || !media || !media.duration || !isFinite(media.duration)) return;
    const p = (media.currentTime / media.duration)*100;
    bar.style.width = Math.max(0, Math.min(100, p)) + '%';
  };
  media.addEventListener('timeupdate', upd);
  media.addEventListener('ended', ()=>{ if(bar) bar.style.width='0%'; });

  toggle.onclick = ()=>{ if(media.paused) media.play(); else media.pause(); };
  stop.onclick = ()=>{ media.pause(); media.currentTime=0; box.style.display='none'; };
}

/* ======== FAVORITES & STATS ======== */
function addFav(type, text){
  const list = JSON.parse(localStorage.getItem('favs')||'[]');
  list.unshift({type, text, ts:Date.now()});
  localStorage.setItem('favs', JSON.stringify(list));
  renderFav();
}
function renderFav(){
  const box = document.getElementById('favList');
  const list = JSON.parse(localStorage.getItem('favs')||'[]');
  if(!list.length){ box.innerHTML = `<div class="card">ูุง ููุฌุฏ ุนูุงุตุฑ ูุญููุธุฉ ุญุชู ุงูุขู.</div>`; return; }
  box.innerHTML = list.map((x,i)=>`
    <div class="card">
      <div class="heading"><strong>${x.type==='dhikr'?'ุฐูุฑ':'ูุต'}</strong><span class="muted">${new Date(x.ts).toLocaleString('ar-EG')}</span></div>
      <p style="white-space:pre-wrap; line-height:2">${x.text}</p>
    </div>
  `).join('');
}
renderFav();

function incStat(kind){
  const key = kind==='azkar'?'statA':'statS';
  const v = (parseInt(localStorage.getItem(key)||'0',10)+1);
  localStorage.setItem(key, v);
  document.getElementById(kind==='azkar'?'statAzkar':'statSurah').textContent = v;
}
(function syncStats(){
  document.getElementById('statAzkar').textContent = parseInt(localStorage.getItem('statA')||'0',10);
  document.getElementById('statSurah').textContent = parseInt(localStorage.getItem('statS')||'0',10);
  document.getElementById('resetStats').onclick = ()=>{ localStorage.removeItem('statA'); localStorage.removeItem('statS'); syncStats(); };
})();

/* ======== QURAN โ full surah playback (sequential ayahs) ======== */
(function(){
  const surahSel = document.getElementById('surahSelect');
  const recSel = document.getElementById('reciterSelect');
  const textBox = document.getElementById('quranText');
  const ayahCounter = document.getElementById('ayahCounter');
  const qProg = document.getElementById('qProg');
  const btnPlay = document.getElementById('playSurah');
  const btnPause = document.getElementById('pauseSurah');
  const btnStop = document.getElementById('stopSurah');
  const btnPrev = document.getElementById('prevAyah');
  const btnNext = document.getElementById('nextAyah');
  const chkRepeat = document.getElementById('repeatAyah');

  const reciters = [
    { id:'ar.alafasy', name:'ูุดุงุฑู ุงูุนูุงุณู' },
    { id:'ar.abdulbasitmurattal', name:'ุนุจุฏุงูุจุงุณุท (ูุฑุชู)' },
    { id:'ar.minshawi', name:'ุงูููุดุงูู' },
    { id:'ar.husary', name:'ุงูุญุตุฑู' },
    { id:'ar.sudais', name:'ุงูุณุฏูุณ' },
    { id:'ar.shuraym', name:'ุงูุดุฑูู' },
    { id:'ar.saadalghamdi', name:'ุณุนุฏ ุงูุบุงูุฏู' },
    { id:'ar.faresabbad', name:'ูุงุฑุณ ุนุจุงุฏ' },
    { id:'ar.maheralmuaiqly', name:'ูุงูุฑ ุงููุนูููู' }
  ];

  reciters.forEach(r=>{
    const o = document.createElement('option');
    o.value=r.id; o.textContent=r.name; recSel.appendChild(o);
  });
  recSel.value = localStorage.getItem('reciter') || 'ar.alafasy';
  recSel.onchange = ()=> localStorage.setItem('reciter', recSel.value);

  // load surah list
  fetch('https://api.alquran.cloud/v1/surah').then(r=>r.json()).then(j=>{
    if(!(j && j.data)) throw new Error('no data');
    j.data.forEach(s=>{
      const o = document.createElement('option');
      o.value = s.number; o.textContent = `${s.number}. ${s.name}`; surahSel.appendChild(o);
    });
    surahSel.value = localStorage.getItem('surah') || '1';
  }).catch(()=>{
    for(let i=1;i<=114;i++){
      const o = document.createElement('option');
      o.value = i; o.textContent = `${i}. ุณูุฑุฉ ${i}`; surahSel.appendChild(o);
    }
  });
  surahSel.onchange = ()=> localStorage.setItem('surah', surahSel.value);

  let audio = new Audio();
  let playlist = []; // array of {audio, ayahNumber}
  let idx = 0;
  let total = 0;

  function highlight(n){
    textBox.querySelectorAll('.ayah').forEach(el=> el.classList.remove('current'));
    const el = textBox.querySelector(`.ayah[data-n="${n}"]`);
    if(el){ el.classList.add('current'); el.scrollIntoView({behavior:'smooth', block:'center'}); }
  }
  function updateCounter(){
    ayahCounter.textContent = `${idx+1} / ${total} ุขูุฉ`;
  }
  function bindProgress(){
    audio.ontimeupdate = ()=>{
      if(audio.duration && isFinite(audio.duration)){
        const p = (audio.currentTime / audio.duration)*100;
        qProg.style.width = Math.max(0, Math.min(100, p)) + '%';
      }
    };
    audio.onended = ()=>{
      if(chkRepeat.checked){ audio.currentTime=0; audio.play(); return; }
      next();
    };
  }
  function play(i){
    if(i<0 || i>=playlist.length){ incStat('surah'); return; }
    idx = i;
    audio.src = playlist[idx].audio;
    audio.play().then(()=>{
      setMini(audio, `ุณูุฑุฉ ${surahSel.options[surahSel.selectedIndex].text} โ ${recSel.options[recSel.selectedIndex]?.text||''}`);
      highlight(playlist[idx].ayahNumber);
      updateCounter();
    }).catch(()=>{
      // ูู ุงูุขูุฉ ุฏู ูุดูุชุ ุญุงูู ุงููู ุจุนุฏูุง
      next();
    });
  }
  function next(){
    if(idx+1 < playlist.length) play(idx+1);
  }
  function prev(){
    if(idx-1 >= 0) play(idx-1);
  }

  async function loadAndPlay(){
    const surah = parseInt(surahSel.value||'1',10);
    const rec = recSel.value || 'ar.alafasy';

    // ูุต ุงูุณูุฑุฉ
    textBox.innerHTML = '<div class="card">ุฌุงุฑู ุชุญููู ูุต ุงูุณูุฑุฉโฆ</div>';
    fetch(`https://api.alquran.cloud/v1/surah/${surah}`).then(r=>r.json()).then(j=>{
      if(j && j.data){
        textBox.innerHTML = j.data.ayahs.map(a=>`
          <span class="ayah" data-n="${a.numberInSurah}">${a.text} <span class="num">(${a.numberInSurah})</span></span>
        `).join(' ');
      }else{
        textBox.innerHTML = `<div class="card">ุชุนุฐูุฑ ุฌูุจ ุงููุต โ ุญุงูู ูุฌุฏุฏูุง.</div>`;
      }
    }).catch(()=>{
      textBox.innerHTML = `<div class="card">ุชุนุฐูุฑ ุฌูุจ ุงููุต โ ุชุญูู ูู ุงุชุตุงูู.</div>`;
    });

    // ุงูุตูุช: ูู ุขูุฉ ุนูู ุญุฏุฉ ูุชุดุบูู ุงูุณูุฑุฉ ูุงููุฉ
    playlist = [];
    idx = 0; total = 0; updateCounter(); qProg.style.width='0%';
    audio.pause(); audio.currentTime=0; bindProgress();

    // ูุญุงูู ุจุงูููุฑุฆ ุงููุฎุชุงุฑ ุซู ูุณูุท ุนูู ููุฑุฆูู ูุดููุฑูู ูู ูุดู
    const fallbacks = [rec, 'ar.abdulbasitmurattal', 'ar.alafasy'];
    let got = false, lastError = null;
    for(const ed of fallbacks){
      try{
        const r = await fetch(`https://api.alquran.cloud/v1/surah/${surah}/${ed}`);
        const j = await r.json();
        if(j && j.data && j.data.ayahs && j.data.ayahs.length){
          playlist = j.data.ayahs.map(a=>({audio:a.audio, ayahNumber:a.numberInSurah}));
          total = playlist.length; updateCounter();
          got = true;
          if(ed!==rec){ toast(`ุชุนุฐูุฑ ุชุดุบูู ุงููุงุฑุฆ ุงููุทููุจ โ ุชู ุงูุชุจุฏูู ูุคูุชูุง ุฅูู ${ed}`); }
          break;
        }
      }catch(err){ lastError = err; }
    }
    if(!got){
      alert('ุชุนุฐูุฑ ุชุดุบูู ุงูุณูุฑุฉ โ ุฌุฑูุจ ูุงุฑุฆูุง ุขุฎุฑ');
      return;
    }
    play(0);
  }

  btnPlay.onclick = loadAndPlay;
  btnPause.onclick = ()=>{ if(audio.paused) audio.play(); else audio.pause(); };
  btnStop.onclick = ()=>{ audio.pause(); audio.currentTime=0; };
  btnNext.onclick = next;
  btnPrev.onclick = prev;
})();

/* ======== AZKAR (summary placeholders to ensure not empty) ======== */
const AZKAR_DATA = { sabah: [ { text: `ุฃูุนููุฐู ุจูุงูููู ูููู ุงูุดููููุทูุงูู ุงูุฑููุฌูููู
ุงููููู ูุงู ุฅูููููู ุฅููุงูู ูููู ุงููุญูููู ุงูููููููููู ... [ุขูุฉ ุงููุฑุณู - ุงูุจูุฑุฉ 255].`, count: 1, note: `ูู ูุงููุง ุญูู ูุตุจุญ ุฃุฌูุฑ ูู ุงูุฌู ุญุชู ููุณู.` }, { text: `ุจูุณููู ุงูููู ุงูุฑููุญูููู ุงูุฑููุญููู
ูููู ูููู ูฑูููููู ุฃูุญูุฏูุ ูฑูููููู ูฑูุตููููุฏูุ ูููู ููููุฏู ูููููู ูููููุฏูุ ูููููู ููููู ูููููฅ ููููููุง ุฃูุญูุฏูข.`, count: 3, note: null }, { text: `ุจูุณููู ุงูููู ุงูุฑููุญูููู ุงูุฑููุญููู
ูููู ุฃูุนููุฐู ุจูุฑูุจูู ูฑููููููููุ ููู ุดูุฑูู ููุง ุฎูููููุ ููููู ุดูุฑูู ุบูุงุณููู ุฅูุฐูุง ููููุจูุ ููููู ุดูุฑูู ูฑูููููููุงุซูุงุชู ููู ูฑููุนูููุฏูุ ููููู ุดูุฑูู ุญูุงุณูุฏู ุฅูุฐูุง ุญูุณูุฏู.`, count: 3, note: null }, { text: `ุจูุณููู ุงูููู ุงูุฑููุญูููู ุงูุฑููุญููู
ูููู ุฃูุนููุฐู ุจูุฑูุจูู ูฑููููุงุณูุ ูููููู ูฑููููุงุณูุ ุฅููููฐูู ูฑููููุงุณูุ ููู ุดูุฑูู ูฑููููุณูููุงุณู ูฑููุฎููููุงุณู...`, count: 3, note: null }, { text: `ุฃูุตููุจูุญููุง ููุฃูุตููุจูุญู ุงููููููู ููู ... ุฑูุจูู ุฃูุนููุฐู ุจููู ูููู ุนููุฐุงุจู ูู ุงููููุงุฑู ููุนููุฐุงุจู ูู ุงููููุจูุฑ.`, count: 1, note: null }, { text: `ุงูููููููู ุฃูููุชู ุฑูุจูููู ูุง ุฅููู ุฅูุงู ุฃูููุชู ... ููุงุบููููุฑู ูู ููุฅููููููู ูุง ููุบููููุฑู ุงูุฐูููููุจู ุฅููุงู ุฃูููุชู.`, count: 1, note: `ูู ูุงููุง ูููููุง ุจูุง ุตุจุงุญูุง ููุงุช ุฏุฎู ุงูุฌูุฉ.` }, { text: `ุฑูุถููุชู ุจูุงูููู ุฑูุจูููุงู ููุจูุงูุฅุณููุงูู ุฏูููุงู ููุจูููุญูููููุฏู ๏ทบ ููุจููููุงู.`, count: 3, note: `ูู ูุงููุง ุตุจุงุญูุง ููุณุงุกู ูุงู ุญููุง ุนูู ุงููู ุฃู ูุฑุถูู.` }, { text: `ุงููููููููู ุฅูููููู ุฃูุตููุจููุญููุชู ุฃูุดููููุฏูู ... ุฃูููู ููุญููููุฏุงู ุนูุจููุฏููู ููุฑูุณูููููู.`, count: 4, note: `ูู ูุงููุง ุฃุนุชูู ุงููู ูู ุงููุงุฑ.` }, { text: `ุงููููููููู ูุง ุฃูุตูุจููุญู ุจู ููููู ููุนููููุฉู ... ููููููู ุงููุญููููุฏู ููููููู ุงูุดูููููุฑ.`, count: 1, note: `ุฃุฏูู ุดูุฑ ูููู.` }, { text: `ุญูุณูุจูููู ุงููููู ูุง ุฅููู ุฅูุงู ูููู ุนููููููู ุชููููููููุชู ูููููู ุฑูุจูู ุงูุนูุฑูุดู ุงูุนูุธููู.`, count: 7, note: `ููุงู ุงููู ูุง ุฃููู.` }, { text: `ุจูุณููู ุงูููู ุงูุฐู ูุง ููุถููุฑูู ูุน ุงุณููููู ุดูุกู ูู ุงูุฃุฑุถ ููุง ูู ุงูุณูุงุก ููู ุงูุณููุนู ุงูุนููู.`, count: 3, note: `ูู ูุถุฑู ุดูุก.` }, { text: `ุงููููููููู ุจููู ุฃูุตููุจูุญููุง ููุจููู ุฃูููุณููููุงุ ููุจููู ููุญูููุง ููุจููู ููููููุชู ููุฅูููููููู ุงูููููุดููุฑ.`, count: 1, note: null }, { text: `ุฃูุตูุจููุญูููุง ุนูููู ููุทูุฑูุฉู ุงูุฅุณููุงููู... ููููุง ููุงูู ูููู ุงูููุดูุฑูููููู.`, count: 1, note: null }, { text: `ุณูุจูุญูุงูู ุงูููู ููุจูุญููููุฏููู ุนูุฏูุฏู ุฎููููููู ุ ููุฑูุถูุง ููููุณููู ุ ููุฒููููุฉู ุนููุฑูุดููู ุ ูููููุฏุงุฏู ููููููุงุชููู.`, count: 3, note: null }, { text: `ุงููููููููู ุนุงููููู ูู ุจูุฏูููู ุ ุงููููููููู ุนุงููููู ูู ุณููููุนู ุ ุงููููููููู ุนุงููููู ูู ุจูุตููุฑู ุ ูุง ุฅููู ุฅูุงู ุฃููููุชู.`, count: 3, note: null }, { text: `ุงููููููููู ุฅููููู ุฃูุนููุฐู ุจููู ูููู ุงููููููุฑ ุ ููุงููููููุฑ ุ ูููููู ุนูุฐุงุจู ุงููููุจูุฑ.`, count: 3, note: null }, { text: `ุงููููููููู ุฅูููููู ุฃุณููุฃูููููู ุงูุนูููููู ููุงูุนูุงููููุฉู ... ููุฃูุนููุฐู ุจูุนูุธููููุชููู ุฃูู ุฃูุบููุชุงูู ููู ุชูุญูุชูู.`, count: 1, note: null }, { text: `ููุง ุญูููู ููุง ููููููู ุจูุฑูุญูููุชููู ุฃุณูุชูุบููุซู... ููุงู ุชูููููููู ุฅููู ููููุณูู ุทูุฑูููุฉู ุนููููู.`, count: 3, note: null }, { text: `ุงููููููููู ุนุงููููู ุงูุบููููุจู ููุงูุดูููุงุฏูุฉู... ุฃููู ุฃูุฌููุฑูููู ุฅูููู ููุณููููู.`, count: 1, note: null }, { text: `ุฃูุนููุฐู ุจูููููููุงุชู ุงููููู ุงูุชููุงูููุงุชู ูููู ุดููุฑูู ูุง ุฎููููู.`, count: 3, note: null }, { text: `ุงููููููููู ุตูููู ููุณูููููู ููุจูุงุฑููู ุนูู ููุจููููููุง ููุญูููุฏ.`, count: 10, note: `ูู ุตูู ุนููู ุตุจุงุญูุง ููุณุงุกู ุฃุฏุฑูุชู ุดูุงุนุชู.` }, { text: `ุงููููููููู ุฅููููุง ููุนููุฐู ุจููู ูููู ุฃููู ููุดูุฑููู ุจููู ุดูููุฆูุง ููุนููููููู ุ ููููุณูุชูุบูููุฑููู ููููุง ููุง ููุนููููููู.`, count: 3, note: null }, { text: `ุงููููููููู ุฅููููู ุฃูุนููุฐู ุจููู ูููู ุงููููููู ููุงููุญูุฒูููุ ููุงููุนูุฌูุฒู ููุงููููุณูููุ ููุงููุฌูุจููู ููุงููุจูุฎูููุ ููุบูููุจูุฉู ุงูุฏูููููู ููููููุฑู ุงูุฑููุฌูุงูู.`, count: 3, note: null }, { text: `ุฃุณูุชูุบูููุฑู ุงูููู ุงูุนูุธูููู ุงูููุฐูู ูุงู ุฅูููู ุฅูุงูู ููููุ ุงูุญูููู ุงูููููููููุ ููุฃุชููุจู ุฅููููู.`, count: 3, note: null }, { text: `ููุง ุฑูุจููุ ูููู ุงููุญูููุฏู ููููุง ููููุจูุบูู ููุฌูููุงูู ููุฌูููููุ ููููุนูุธูููู ุณูููุทูุงูููู.`, count: 3, note: null }, { text: `ุงููููููููู ุฅููููู ุฃูุณูุฃููููู ุนูููููุง ููุงููุนูุงุ ููุฑูุฒูููุง ุทููููุจูุงุ ููุนูููููุง ููุชูููุจููููุง.`, count: 1, note: null }, { text: `ุงููููููููู ุฃูููุชู ุฑูุจููู ูุง ุฅููููู ุฅููุง ุฃูููุชู ุ ุนููููููู ุชููููููููุชู ... ุฅูููู ุฑูุจููู ุนูููู ุตูุฑูุงุทู ููุณูุชูููููู.`, count: 1, note: `ุฐูุฑ ุทููุจ.` }, { text: `ููุง ุฅููููู ุฅููููุง ุงูููู ููุญูุฏููู ููุง ุดูุฑูููู ูููู... ูููููู ุนูููู ููููู ุดูููุกู ููุฏููุฑู.`, count: 100, note: `ูุงูุช ูู ุนุฏู ุนุดุฑ ุฑูุงุจโฆ ูุญุฑุฒูุง ูู ุงูุดูุทุงู.` }, { text: `ุณูุจูุญูุงูู ุงูููู ููุจูุญูููุฏููู.`, count: 100, note: `ุญูุทุช ุฎุทุงูุงู ูุฅู ูุงูุช ูุซู ุฒุจุฏ ุงูุจุญุฑ.` }, { text: `ุฃุณูุชูุบูููุฑู ุงูููู ููุฃุชููุจู ุฅูููููู.`, count: 100, note: null } ], masa: [ { text: `ูููู ูููู ูฑูููููู ุฃูุญูุฏู ...`, count: 3, note: null }, { text: `ูููู ุฃูุนููุฐู ุจูุฑูุจูู ูฑูููููููู ...`, count: 3, note: null }, { text: `ูููู ุฃูุนููุฐู ุจูุฑูุจูู ูฑููููุงุณู ...`, count: 3, note: null }, { text: `ุขูููู ุงูุฑููุณูููู ... [ุงูุจูุฑุฉ 285-286]`, count: 1, note: `ุงูุขูุชุงู ูู ุขุฎุฑ ุณูุฑุฉ ุงูุจูุฑุฉุ ูู ูุฑุฃููุง ูู ูููุฉ ููุชุงู.` }, { text: `ุขูุฉ ุงููุฑุณู [ุงูุจูุฑุฉ 255].`, count: 1, note: `ุฃุฌูุฑ ูู ุงูุฌู ุญุชู ูุตุจุญ.` }, { text: `ุฃูููุณูููููุง ููุฃูููุณูู ุงูููููู ููู...`, count: 1, note: null }, { text: `ุณูุฏ ุงูุงุณุชุบูุงุฑ: ุงูููููููู ุฃูููุชู ุฑูุจูููู ...`, count: 1, note: `ูู ูุงููุง ูููููุง ุจูุง ูุณุงุกู ููุงุช ุฏุฎู ุงูุฌูุฉ.` }, { text: `ุฑูุถููุชู ุจูุงูููู ุฑูุจูููุงู ...`, count: 3, note: null }, { text: `ุงููููููููู ุฅูููููู ุฃููุณูุชู ุฃูุดููููุฏูู ...`, count: 4, note: `ูู ูุงููุง ุฃุนุชูู ุงููู ูู ุงููุงุฑ.` }, { text: `ุงููููููููู ูุง ุฃููุณู ุจู ููููู ููุนููููุฉู ...`, count: 1, note: `ุฃุฏูู ุดูุฑ ูููุชู.` }, { text: `ุญูุณูุจูููู ุงููููู ...`, count: 7, note: null }, { text: `ุจูุณููู ุงูููู ุงูุฐู ูุง ููุถููุฑูู ...`, count: 3, note: null }, { text: `ุงููููููููู ุจููู ุฃูููุณููููุง ููุจููู ุฃูุตููุจุญูุง ...`, count: 1, note: null }, { text: `ุฃูููุณูููููุง ุนูููู ููุทูุฑูุฉู ุงูุฅุณููุงููู ...`, count: 1, note: null }, { text: `ุณูุจูุญูุงูู ุงูููู ููุจูุญููููุฏููู ุนูุฏูุฏู ุฎููููููู ...`, count: 3, note: null }, { text: `ุงููููููููู ุนุงููููู ูู ุจูุฏูููู ...`, count: 3, note: null }, { text: `ุงููููููููู ุฅููููู ุฃูุนููุฐู ุจููู ูููู ุงููููููุฑ ...`, count: 3, note: null }, { text: `ุงููููููููู ุฅูููููู ุฃุณููุฃูููููู ุงูุนูููููู ููุงูุนูุงููููุฉู ...`, count: 1, note: null }, { text: `ููุง ุญูููู ููุง ููููููู ...`, count: 3, note: null }, { text: `ุฃูููุณููููุง ููุฃูููุณูู ุงูููููููู ูููู ุฑูุจูู ุงููุนูุงูููููููู ...`, count: 1, note: null }, { text: `ุงููููููููู ุนุงููููู ุงูุบููููุจู ููุงูุดูููุงุฏูุฉู ...`, count: 1, note: null }, { text: `ุฃูุนููุฐู ุจูููููููุงุชู ุงููููู ุงูุชููุงูููุงุชู ...`, count: 3, note: null }, { text: `ุงููููููููู ุตูููู ููุณูููููู ...`, count: 10, note: null }, { text: `ุงููููููููู ุฅููููุง ููุนููุฐู ุจููู ...`, count: 3, note: null }, { text: `ุงููููููููู ุฅููููู ุฃูุนููุฐู ุจููู ูููู ุงููููููู ...`, count: 3, note: null }, { text: `ุฃุณูุชูุบูููุฑู ุงูููู ุงูุนูุธูููู ...`, count: 3, note: null }, { text: `ููุง ุฑูุจูู , ูููู ุงููุญูููุฏู ...`, count: 3, note: null }, { text: `ุงููููููููู ุฅููููู ุฃูุณูุฃููููู ุนูููููุง ููุงููุนูุง ...`, count: 1, note: null }, { text: `ุงููููููููู ุฃูููุชู ุฑูุจููู ... (ุฐูุฑ ุทูุจ).`, count: 1, note: null }, { text: `ููุง ุฅููู ุฅููุง ุงูููู ููุญูุฏููู ...`, count: 100, note: null }, { text: `ุณูุจูุญูุงูู ุงูููู ููุจูุญููููุฏููู.`, count: 100, note: null }, { text: `ุฃุณูุชูุบูููุฑู ุงูููู ููุฃุชููุจู ุฅูููููู.`, count: 100, note: null } ], prayer: [ { text: `ุฃุณุชุบูุฑ ุงููู (ุซูุงุซูุง) ุซู: ุงูููู ุฃูุช ุงูุณูุงู ูููู ุงูุณูุงู ุชุจุงุฑูุช ูุง ุฐุง ุงูุฌูุงู ูุงูุฅูุฑุงู.`, count: 1, note: null }, { text: `ูุง ุฅูู ุฅูุง ุงููู ูุญุฏู ูุง ุดุฑูู ููุ ูู ุงูููู ููู ุงูุญูุฏ ููู ุนูู ูู ุดูุก ูุฏูุฑ ...`, count: 1, note: `ููุฌูุฑ ุจูุง ุจุนุฏ ุงูุตููุงุชุ ููุฒุงุฏ ุจุนุฏ ุงููุฌุฑ ูุงููุบุฑุจ ุนุดุฑ ูุฑุงุช: ูุญูู ููููุช ููู ุนูู ูู ุดูุก ูุฏูุฑ.` }, { text: `ุชุณุจูุญ 33 + ุชุญููุฏ 33 + ุชูุจูุฑ 33 ุซู ุชูุงู ุงููุฆุฉ: ูุง ุฅูู ุฅูุง ุงููู ูุญุฏู ูุง ุดุฑูู ููุ ูู ุงูููู ููู ุงูุญูุฏ ููู ุนูู ูู ุดูุก ูุฏูุฑ.`, count: 1, note: null }, { text: `ุขูุฉ ุงููุฑุณูุ ุซู ูู ูู ุงููู ุฃุญุฏ ูุงููุนูุฐุชุงู (ูุฑุฉุ ููู ุงููุฌุฑ ูุงููุบุฑุจ ุซูุงุซ ูุฑุงุช).`, count: 1, note: null }, { text: `ุงูููู ุฅูู ุฃุนูุฐ ุจู ูู ุงูุฌุจูุ ูุฃุนูุฐ ุจู ูู ุงูุจุฎูุ ูุฃุนูุฐ ุจู ูู ุฃุฑุฐู ุงูุนูุฑุ ูุฃุนูุฐ ุจู ูู ูุชูุฉ ุงูุฏููุง ูุนุฐุงุจ ุงููุจุฑ.`, count: 1, note: null } ], ruqyah: [ { text: `ุงููุงุชุญุฉ ูุงููุฉ.`, count: 1, note: null }, { text: `ุฃูู ุงูุจูุฑุฉ: ุงูููู * ุฐููฐูููู ุงููููุชูุงุจู ... [ุงูุจูุฑุฉ: 1-4]`, count: 1, note: null }, { text: `[ุงูุจูุฑุฉ:20] ููููุงุฏู ุงููุจูุฑููู ููุฎูุทููู ุฃูุจูุตูุงุฑููููู ...`, count: 1, note: null }, { text: `[ุงูุจูุฑุฉ:60] ููุฅูุฐู ุงุณูุชูุณูููู ูููุณูู ูููููููููู ...`, count: 1, note: null }, { text: `[ุงูุจูุฑุฉ:69] ููุงูููุง ุงุฏูุนู ููููุง ุฑูุจูููู ููุจูููููู ููููุง ...`, count: 1, note: null }, { text: `[ุงูุจูุฑุฉ:102] ููุงุชููุจูุนููุง ููุง ุชูุชูููู ุงูุดููููุงุทูููู ...`, count: 1, note: null }, { text: `[ุงูุจูุฑุฉ:109] ููุฏูู ููุซููุฑู ููููู ุฃููููู ุงููููุชูุงุจู ...`, count: 1, note: null }, { text: `[ุงูุจูุฑุฉ:255] ุขูุฉ ุงููุฑุณู.`, count: 1, note: null }, { text: `[ุงูุจูุฑุฉ:285-286] ุขูู ุงูุฑุณูู ...`, count: 1, note: null }, { text: `[ุงููุณุงุก:32] ููููุง ุชูุชููููููููุง ููุง ููุถูููู ุงูููููู ...`, count: 1, note: null }, { text: `[ุงููุณุงุก:54] ุฃููู ููุญูุณูุฏูููู ุงููููุงุณู ...`, count: 1, note: null }, { text: `[ุงูุฃูุนุงู:103] ูุงูู ุชูุฏูุฑููููู ุงูุฃูุจูุตูุงุฑู ...`, count: 1, note: null }, { text: `[ุงูุชูุจุฉ:55] ูููุงู ุชูุนูุฌูุจููู ุฃูููููุงูููููู ...`, count: 1, note: null }, { text: `[ููุณู:67] ููุง ุจูููููู ูุงู ุชูุฏูุฎููููุงู ููู ุจูุงุจู ููุงุญูุฏู ...`, count: 1, note: null }, { text: `[ููุฏ:37] ููุงุตูููุนู ุงูููููููู ุจูุฃูุนูููููููุง ...`, count: 1, note: null }, { text: `[ุงูุญุฌุฑ:16-18] ููููููุฏู ุฌูุนูููููุง ููู ุงูุณููููุงุกู ุจูุฑููุฌูุง ...`, count: 1, note: null }, { text: `[ุทู:131] ููููุง ุชูููุฏููููู ุนููููููููู ...`, count: 1, note: null }, { text: `[ุงููุตุต:79] ููุฎูุฑูุฌู ุนูููู ูููููููู ููู ุฒููููุชููู ...`, count: 1, note: null }, { text: `[ุงูููู:39] ููููููููุง ุฅูุฐู ุฏูุฎูููุชู ุฌููููุชููู ...`, count: 1, note: null }, { text: `[ุงูุตุงูุงุช:88-90] ููููุธูุฑู ููุธูุฑูุฉู ููู ุงููููุฌูููู ...`, count: 1, note: null }, { text: `[ุงููุชุญ:15] ุณูููููููู ุงููููุฎููููููููู ...`, count: 1, note: null }, { text: `[ุงูููู:1-4] ุชุจุงุฑู ุงูุฐู ุจูุฏู ุงูููู ...`, count: 1, note: null }, { text: `[ุงูููู:1-5] ู ูุงูููู ููุง ูุณุทุฑูู ...`, count: 1, note: null }, { text: `[ุงูููู:51] ูุฅู ููุงุฏ ุงูุฐูู ููุฑูุง ููุฒููููู ุจุฃุจุตุงุฑูู ...`, count: 1, note: null }, { text: `[ุงูุทูุฑ:48] ูุงุตุจุฑ ูุญูู ุฑุจู ูุฅูู ุจุฃุนูููุง ...`, count: 1, note: null }, { text: `[ุงูููุงูููู:4] ูุฅุฐุง ุฑุฃูุชูู ุชุนุฌุจู ุฃุฌุณุงููู ...`, count: 1, note: null }, { text: `[ุงูุฅูุณุงู:6] ุนูููุง ูุดุฑุจ ุจูุง ุนุจุงุฏ ุงููู ...`, count: 1, note: null }, { text: `[ุงูุชูุจุฉ:14-15] ูุงุชูููู ูุนุฐุจูู ุงููู ...`, count: 1, note: null }, { text: `[ูููุณ:57] ูุง ุฃููุง ุงููุงุณ ูุฏ ุฌุงุกุชูู ููุนุธุฉ ...`, count: 1, note: null }, { text: `[ุงููุญู:68-69] ูุฃูุญู ุฑุจู ุฅูู ุงููุญู ... ููู ุดูุงุก ูููุงุณ`, count: 1, note: null }, { text: `[ุงูุฅุณุฑุงุก:82] ูููุฒู ูู ุงููุฑุขู ูุง ูู ุดูุงุก ...`, count: 1, note: null }, { text: `[ุงูุดุนุฑุงุก:80] ูุฅุฐุง ูุฑุถุช ููู ูุดููู`, count: 1, note: null }, { text: `[ูุตูุช:44] ูู ูู ููุฐูู ุขูููุง ูุฏู ูุดูุงุก ...`, count: 1, note: null }, { text: `ุงูุฅุฎูุงุตุ ุงููููุ ุงููุงุณ.`, count: 3, note: null }, { text: `ุงููููููููู ุฅููููู ุนูุจูุฏููู ... ุงุฌุนู ุงููุฑุขู ุฑุจูุน ููุจู ...`, count: 1, note: null }, { text: `ุชุญุตูููุชู ุจุงูููู ... ุญุณุจู ุงููู ููุนู ุงููููู ...`, count: 1, note: null }, { text: `ุงููููููู ุฑูุญูููุชููู ููุฑูุฌูู ...`, count: 1, note: null }, { text: `ุงูููู ุฐุง ุงูุณูุทุงู ุงูุนุธูู ... ุนุงููู ูุนุงู ุงููุณูููู ...`, count: 1, note: null }, { text: `ุงูููู ุงุตุฑู ุนูู ุญุฑ ุงูุนูู ูุจุฑุฏ ุงูุนูู ููุตุจ ุงูุนูู.`, count: 1, note: null }, { text: `ุงูููู ุฑุจ ุงููุงุณ ุฃุฐูุจ ุงูุจุฃุณ ูุงุดู ุฃูุช ุงูุดุงูู ...`, count: 1, note: null }, { text: `ุจุณู ุงููู ุฃุฑูู ููุณู ูู ูู ุดูุก ูุคุฐููู ...`, count: 1, note: null } ], sleep: [ { text: `ูุฌูุน ูููู ููููุซ ููููุง ูููุฑุฃ: ุงูุฅุฎูุงุตุ ุงููููุ ุงููุงุณ (ุซูุงุซูุง) ุซู ููุณุญ ุจููุง ูุง ุงุณุชุทุงุน ูู ุฌุณุฏู.`, count: 3, note: null }, { text: `ุขูุฉ ุงููุฑุณู.`, count: 1, note: null }, { text: `ุฎูุงุชูู ุณูุฑุฉ ุงูุจูุฑุฉ (ุขูููู ุงูุฑููุณูููู...) [ุงูุจูุฑุฉ: 285-286].`, count: 1, note: null }, { text: `ุจูุงุณููููู ุฑูุจููู ููุถูุนูุชู ุฌูููุจูู ...`, count: 1, note: null }, { text: `ุงููููููููู ุฅูููููู ุฎูููููุชู ููููุณูู ...`, count: 1, note: null }, { text: `ุงููููููููู ููููู ุนูุฐูุงุจููู ูููููู ุชูุจูุนูุซู ุนูุจูุงุฏููู.`, count: 1, note: null }, { text: `ุจูุงุณููููู ุงููููููููู ุฃููููุชู ููุฃูุญูููุง.`, count: 1, note: null }, { text: `ุชุณุจูุญ 33ุ ุชุญููุฏ 33ุ ุชูุจูุฑ 34.`, count: 1, note: null }, { text: `ุงููููููููู ุฑูุจูู ุงูุณููููููุงุชู ุงูุณููุจูุนู ... ุงููุถู ุนููููุง ุงูุฏูููููู ูุฃุบููุง ูู ุงูููุฑ.`, count: 1, note: null }, { text: `ุงูุญูุฏ ููู ุงูุฐู ุฃุทุนููุง ูุณูุงูุง ูููุงูุง ูุขูุงูุง ...`, count: 1, note: null }, { text: `ุงููููููููู ุนูุงูููู ุงูุบูููุจู ููุงูุดููููุงุฏูุฉู ...`, count: 1, note: null }, { text: `ูุฑุงุกุฉ: ุงูู ุชูุฒูู ุงูุณุฌุฏุฉุ ูุชุจุงุฑู ุงูุฐู ุจูุฏู ุงูููู.`, count: 1, note: null }, { text: `ุงููููููููู ุฃูุณูููููุชู ููููุณูู ุฅููููููู ... ููุจูููุจูููููู ุงูููุฐูู ุฃูุฑูุณูููุชู.`, count: 1, note: null } ], wudu: [ { text: `ูุจู ุงููุถูุก: ุจุณู ุงููู.`, count: 1, note: `ุซุจุชุช ุงูุชุณููุฉ ุนูู ุงูุฑุงุฌุญ.` }, { text: `ุจุนุฏ ุงููุถูุก:
ุฃุดูููุฏู ุฃูู ูุง ุฅูู ุฅููุงูู ุงูููููู ููุญูุฏููู ูุง ุดูุฑููู ููููุ ูุฃุดูููุฏู ุฃููู ููุญููููุฏุงู ุนูุจูุฏููู ููุฑูุณูููููู.
ุงููููููููู ุงุฌูุนูููููู ูููู ุงูุชููููุงุจููููุ ูุงุฌูุนููููู ูููู ุงูููุชูุทููููุฑูููู.
ุณูุจูุญุงูููู ุงููููููููู ูุจูุญูููุฏูููุ ุฃุดูููุฏู ุฃูู ูุง ุฅููู ุฅููุงูู ุฃูููุชูุ ุฃุณูุชูุบูููุฑููู ูุฃุชููุจู ุฅููููููู.`, count: 1, note: null } ] };

(function(){
  const tabs = document.getElementById('azTabs');
  const box = document.getElementById('azContainer');
  const q = document.getElementById('azSearch');
  let key = 'sabah', timer = null, idx = 0;

  function render(){
    const list = (AZKAR_DATA[key]||[]).filter(item=>{
      const s = (q.value||'').trim();
      if(!s) return true; return (item.text||'').includes(s);
    });
    if(!list.length){ box.innerHTML = `<div class="card">ูุง ุชูุฌุฏ ุจูุงูุงุช ููุฐุง ุงููุณู ุญุงูููุง.</div>`; return; }
    box.innerHTML = list.map((z,i)=>`
      <div class="card" data-i="${i}">
        <div class="heading">
          <strong>ุฐูุฑ #${i+1}</strong>
          <span class="badge">ุงูุชูุฑุงุฑ: ${z.count||1}</span>
        </div>
        <p style="line-height:2; white-space:pre-wrap">${z.text}</p>
        ${z.note?`<div class="pill" style="margin-top:6px; white-space:pre-wrap">${z.note}</div>`:''}
        <div class="row" style="margin-top:8px">
          <button class="btn sm" data-done="${i}">โ ุชู</button>
          <button class="btn sm ghost" data-share="${i}">๐ ูุดุงุฑูุฉ</button>
          <button class="btn sm ghost" data-fav="${i}">โญ ุญูุธ</button>
          <button class="btn sm" data-chime="${i}">๐ ูุคุซุฑ</button>
        </div>
      </div>
    `).join('');
  }

  tabs.addEventListener('click', (e)=>{
    const k = e.target.getAttribute('data-key'); if(!k) return;
    key = k; tabs.querySelectorAll('.tab').forEach(t=>t.classList.remove('active')); e.target.classList.add('active');
    render();
  });
  q.addEventListener('input', render);

  box.addEventListener('click', (e)=>{
    const done = e.target.getAttribute('data-done');
    const share = e.target.getAttribute('data-share');
    const fav = e.target.getAttribute('data-fav');
    const chime = e.target.getAttribute('data-chime');
    if(done!=null){ e.target.closest('.card').style.opacity=.6; incStat('azkar'); }
    if(share!=null){
      const t = (AZKAR_DATA[key]||[])[parseInt(share,10)].text;
      if(navigator.share){ navigator.share({text:t}).catch(()=>{}); } else { navigator.clipboard.writeText(t).catch(()=>{}); }
    }
    if(fav!=null){
      const t = (AZKAR_DATA[key]||[])[parseInt(fav,10)].text;
      addFav('dhikr', t);
    }
    if(chime!=null){ beep(); }
  });

  document.getElementById('copyAll').onclick = ()=>{
    const list = (AZKAR_DATA[key]||[]).map(x=>`โข ${x.text}`).join('\n\n');
    navigator.clipboard.writeText(list).then(()=>alert('ุชู ูุณุฎ ุฌููุน ุงูุฃุฐูุงุฑ ๐')).catch(()=>{});
  };
  document.getElementById('autoRead').onclick = ()=>{
    if(timer){ clearInterval(timer); timer=null; alert('ุชู ุฅููุงู ุงููุถุน ุงููุชุชุงุจุน'); return; }
    idx=0; step();
    timer = setInterval(step, 3000);
    function step(){
      const card = box.querySelector(`[data-i="${idx}"]`);
      if(!card){ clearInterval(timer); timer=null; return; }
      card.scrollIntoView({behavior:'smooth', block:'center'});
      beep(); idx++;
    }
  };

  function beep(){
    const ctx = new (window.AudioContext||window.webkitAudioContext)();
    const o = ctx.createOscillator(); const g = ctx.createGain();
    o.type='sine'; o.frequency.value=880; o.connect(g); g.connect(ctx.destination);
    o.start(); g.gain.setValueAtTime(0.0001, ctx.currentTime);
    g.gain.exponentialRampToValueAtTime(0.25, ctx.currentTime+0.01);
    g.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime+0.25);
    o.stop(ctx.currentTime+0.26);
  }

  render();
})();

/* ======== TOAST ======== */
function toast(msg){
  const t = document.createElement('div');
  t.style.cssText='position:fixed;right:16px;bottom:16px;background:#0ea37a;color:#fff;padding:10px 12px;border-radius:10px;z-index:9999';
  t.textContent=msg;
  document.body.appendChild(t);
  setTimeout(()=>t.remove(), 3500);
}

/* ======== OFFLINE SW (same-document cache) ======== */
(function(){
  if(!('serviceWorker' in navigator)) return;
  const code = `
    const CACHE = 'onefile-v3';
    self.addEventListener('install', (e)=>{
      e.waitUntil(caches.open(CACHE).then(c=>c.addAll(['./'])));
    });
    self.addEventListener('fetch', (e)=>{
      e.respondWith(
        caches.match(e.request).then(r=> r || fetch(e.request).then(res=>{
          if(e.request.mode!=='navigate') return res;
          const copy = res.clone(); caches.open(CACHE).then(c=>c.put(e.request, copy));
          return res;
        }).catch(()=> caches.match('./')))
      );
    });
  `;
  const blob = new Blob([code], {type:'text/javascript'});
  const url = URL.createObjectURL(blob);
  navigator.serviceWorker.register(url);
})();
</script>
</body>
</html>
